<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="./css/style_menu_home.css" />
  <link rel="stylesheet" href="./css/style_home.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <title>B99 | Home</title>
</head>

<body>
  <script type="text/javascript">
    window.addEventListener("scroll", function () {
      var header = document.querySelector("header");
      header.classList.toggle("sticky", window.scrollY > 0);
    });
  </script>
  <div class="conteudo">
    <nav>
      <ul>
        <li>
          <a href="">
            <img src="./img/logob99.svg" alt="">
            <span class="nav-item"></span>
          </a>
        </li>
        <li>
          <a href="">
            <i class="fas fa-home"></i>
            <span class="nav-item">Home</span>
          </a>
        </li>
        <li>
          <a href="./perfil.html">
            <i class="fas fa-user"></i>
            <span class="nav-item">Perfil</span>
          </a>
        </li>
        <li>
          <a href="">
            <i class="fas fa-trophy"></i>
            <span class="nav-item">Quiz</span>
          </a>
        </li>
        <li>
          <a href="">
            <i class="fas fa-trophy"></i>
            <span class="nav-item">Ranking</span>
          </a>
        </li>
        <li>
          <a href="">
            <i class="fas fa-check-to-slot"></i>
            <span class="nav-item">Votação</span>
          </a>
        </li>
        <li>
          <a href="">
            <i class="fas fa-question-circle"></i>
            <span class="nav-item">Sugestão</span>
          </a>
        </li>
        <li>
          <a href="./index.html" class="logout">
            <i class="fas fa-sign-out-alt"></i>
            <span class="nav-item">Log Out</span>
          </a>
        </li>
      </ul>
    </nav>
    <div class="avaliacao">
      <div class="avaliar">
        <div class="frase">
          <h4>Avaliar a série</h4>
        </div>
        <div class="rating">
          <input name="star-radio" id="star1" type="radio">
          <label for="star1">
            <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg%22%3E">
              <path
                d="M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z"
                pathLength="360"></path>
            </svg>
          </label>
          <input name="star-radio" id="star2" type="radio">
          <label for="star2">
            <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg%22%3E">
              <path
                d="M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z"
                pathLength="360"></path>
            </svg>
          </label>
          <input name="star-radio" id="star3" type="radio">
          <label for="star3">
            <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg%22%3E">
              <path
                d="M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z"
                pathLength="360"></path>
            </svg>
          </label>
          <input name="star-radio" id="star4" type="radio">
          <label for="star4">
            <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg%22%3E">
              <path
                d="M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z"
                pathLength="360"></path>
            </svg>
          </label>
          <input name="star-radio" id="star5" type="radio">
          <label for="star5">
            <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg%22%3E">
              <path
                d="M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z"
                pathLength="360"></path>
            </svg>
          </label>
        </div>
        <button onclick="avaliar()">Avaliar</button>
      </div>
      <div class="grafico">
        <div class="notas_avaliacao">
          <div class="notas">Notas</div>
          <div class="num">4.9</div>
          <div class="num_qtd">Avaliado por 240 usuários</div>
        </div>
        <div class="grafico_serie">
          <canvas id="myChart"></canvas>
        </div>
      </div>
    </div>
    <div class="home">
      <div class="metacritic">
        <div class="nome">
          <img src="./img/metascore.svg" alt="">
          Metacritic
        </div>
        <div class="divisoria">
          <div class="titulo">METASCORE <br>
            Comentários geralmente favoráveis com base em 53 comentários críticos.
          </div>
          <div class="nota">
            78
          </div>
        </div>
        <div class="divisoria">
          <div class="titulo">USERSCORE <br>
            Aclamação universal com base em 162 avaliações.
          </div>
          <div class="nota2">
            8.6
          </div>
        </div>
      </div>

      <div class="rotten">
        <div class="nome">
          <img src="./img/tomatoes.svg" alt="">
          Roteen Tomatoes
        </div>
        <div class="divisoria">
          <div class="titulo">AVERAGE TOMATOMETER <br>
            Nota com base nos especialistas tomatometer
          </div>
          <div class="nota_tomatoes">
            <img src="./img/tomatoes.svg" alt=""> 95%
          </div>
        </div>
        <div class="divisoria">
          <div class="titulo">AVERAGE AUDIENCE SCORE<br>
            Nota com base na audiencia do rotten tomatoes
          </div>
          <div class="nota2_tomatoes">
            <img src="./img/pipoca.svg" alt=""> 87%
          </div>
        </div>
      </div>
    </div>
  </div>
</body>

</html>

<script>

  function avaliar(){
    var fkUsuario = sessionStorage.ID_USUARIO;
    var estrela1 = star1.value;
    var estrela2 = star2.value;
    var estrela3 = star3.value;
    var estrela4 = star4.value;
    var estrela5 = star5.value;
    var qtd_estrelas = 0;

    if(estrela1 == 1){
      qtd_estrelas = 1;
    } else if(estrela1 == 1 && estrela2 == 1){
      qtd_estrelas = 2;
    } else if(estrela1 == 1 && estrela2 == 1 && estrela3 == 1){
      qtd_estrelas = 3;
    } else if(estrela1 == 1 && estrela2 == 1 && estrela3 == 1 && estrela4 == 1){
      qtd_estrelas = 4;
    } else if(estrela1 == 1 && estrela2 == 1 && estrela3 == 1 && estrela4 == 1 && estrela5 == 1){
      qtd_estrelas = 5;
    }

    fetch("/usuarios/avaliar", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                estrelasServer: qtd_estrelas,
                fkUsuarioServer: fkUsuario,
            })
        }).then(function (resposta) {
            console.log("ESTOU NO THEN DO entrar()!")

            if (resposta.ok) {
                console.log(resposta);

                resposta.json().then(json => {
                    console.log(json);
                    console.log(JSON.stringify(json));

                    sessionStorage.ESTRELAS_AVALIACAO = json.qtd_estrelas;
                                       

                  
                    window.location = "home.html";
                     // apenas para exibir o loading

                });

            } else {

                console.log("Houve um erro ao tentar realizar o login!");

                resposta.text().then(texto => {
                    console.error(texto);
                    finalizarAguardar(texto);
                });
            }

        }).catch(function (erro) {
            console.log(erro);
        })

        return false;
  }

  var qtd_estrelas = sessionStorage.ESTRELAS_AVALIACAO; 
  /*Gráfico de avaliação*/
  const labels = [
    '1',
    '2',
    '3',
    '4',
    '5',
  ];

  const data = {
    labels: labels,
    datasets: [{
      backgroundColor: 'rgb(255,0,0)',
      borderColor: 'rgb(255,0,0)',
      data: [qtd_estrelas],
      label: 'Avaliação em estrelas'
    },
    ]
  };

  const config = {
    type: 'bar',
    data: data,
    options: {}
  };

  const myChart = new Chart(
    document.getElementById('myChart'),
    config
  )
</script>